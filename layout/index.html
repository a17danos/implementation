<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Membrane</title>
    <style>
        table {
            text-align: center;
        }
        #toggleAllTimes {
            display: inline-block;
            margin-top: 12px;
        }
        .time {
            display: none;
        }
    </style>
</head>
<body>
    <h1>membrane</h1>
    <table id="table"></table>
    <button id="toggleAllResults" type="button" onclick="toggleAllResults();">toggle results</button>
    <button id="toggleAllTimes" type="button" onclick="toggleAllTimes();">show data</button>
    <script>
        const iterations = 4; //120;
        const useCases = ['one', 'two', 'three', 'four', 'five'];
        let table = document.getElementById('table')

        Array.prototype.arithmeticMean = function(){
            return this.reduce(function(sum, value){
                return sum + value
            }, 0) / this.length
        }

        Array.prototype.standardDeviation = function(sample = true) {
            let average = this.arithmeticMean()
            return Math.sqrt(this.map(function(value) {
                return Math.pow(value - average, 2)
            }).reduce(function(sum, value){
                return sum + value
            }, 0) / (this.length - (sample ? 1 : 0)))
        }

        Array.range = function(from, to, step = 1){
            var array = [from];
            while(from + step <= to){
                array[array.length] = from += step;
            }
            return array;
        }

        function toggleDisplay(array, indices) {
            for (var index = 0; index < indices.length; index++) {
                let style = array[indices[index]].style;
                style.display = (style.display) ? '' : 'none';
            }
        }

        function toggleRows(indices) {
            var rows = table.getElementsByTagName('tr');
            toggleDisplay(rows, indices);
        }

        function toggleAllTimes() {
            var text = 'show data';
            var display = 'none';
            let button = document.getElementById('toggleAllTimes');
            if (button.innerText == text) {
                text = 'show statistics';
                display = 'table-cell';
            }
            button.innerText = text;            
            Array.from(document.getElementsByClassName('time')).forEach(element => {                element.style.display = display;
            });
        }

        function toggleAllResults() {
            toggleRows(Array.range(2,useCases.length * 4,2));
        }

        function header() {
            var header = '<tr><th style="white-space:nowrap;">use case</th><th>tech.</th><th>best</th>';
            for (let i = 1; i < iterations - 1; i++) {
                header += `<th class="time">${i+1}</th>`;
            } 
            header += '<th>worst</th><th>avg.</th><th>st.dev</th></tr>';
            table.innerHTML += header;
        }

        function row(name, tech, values, stats = true) {
            values.sort();
            var row = `<tr><td>${name}</td><td>${tech}</td><td>${values[0]}</td>`;
            for (let i = 1; i < iterations - 1; i++) {
                row += '<td class="time">'+values[i]+'</td>';
            }
            var arithmeticMean = stats ? values.arithmeticMean() : "";
            var standardDeviation = stats ? values.standardDeviation() : "";
            row += `<td>${values[values.length-1]}</td><td>${arithmeticMean}</td><td>${standardDeviation}</td></tr>`;
            table.innerHTML += row;
        }

        header();
        for (let name = 0; name < useCases.length; name++) {
            var times = [];
            var results = [];
            for (let index = 0; index < iterations; index++) {
                times[index] = Math.random();
                results[index] = `"${times[index].toFixed(2)}"`;
            }
            row(useCases[name], 'asm.js', times);
            row('', '', results, false);
            for (let index = 0; index < iterations; index++) {
                times[index] = Math.random();
                results[index] = `"${times[index].toFixed(2)}"`;
            }
            row('', 'wasm', times);
            row('', '', results, false);
        }

        toggleAllResults();
    </script>
</body>
</html>