<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Membrane</title>
    <style>
        table {
            text-align: center;
        }
        #toggleValues {
            display: inline-block;
            margin-top: 12px;
        }
        .visible {
            display: table-cell;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>membrane</h1>
    <table id="table"></table>
    <button id="toggleValues" type="button" onclick="toggleValues()">show all values</button>
    <script>
        const iterations = 120;

        Array.prototype.arithmeticMean = function(){
            return this.reduce(function(sum, value){
                return sum + value
            }, 0) / this.length
        }

        Array.prototype.standardDeviation = function(sample = true) {
            let average = this.arithmeticMean()
            return Math.sqrt(this.map(function(value) {
                return Math.pow(value - average, 2)
            }).reduce(function(sum, value){
                return sum + value
            }, 0) / (this.length - (sample ? 1 : 0)))
        }

        function toggleValues() {
            const showAllValues = 'show all values';
            const hideMostValues = 'hide most values';

            let button = document.getElementById('toggleValues');
            if (button.innerText == showAllValues) {
                button.innerText = hideMostValues;
            } else {
                button.innerText = showAllValues;
            }
            let visible = Array.from(document.getElementsByClassName('visible'));
            let hidden = Array.from(document.getElementsByClassName('hidden'));
            visible.forEach(element => {
                element.classList.remove('visible');
            });
            hidden.forEach(element => {
                element.classList.remove('hidden');
            });
            visible.forEach(element => {
                element.classList.add('hidden');
            });
            hidden.forEach(element => {
                element.classList.add('visible');
            });
        }

        function header() {
            var header = '<tr><th style="white-space:nowrap;">use case</th><th>best</th><th class="visible">&hellip;</th>';
            for (let i = 1; i < iterations - 1; i++) {
                header += `<th class="hidden">${i+1}</th>`;
            } 
            header += '<th>worst</th><th>avg.</th><th>st.dev</th></tr>';
            return header;
        }

        function row(name, values) {
            values.sort();
            var row = `<tr><td>${name}</td><td>${values[0]}</td><td class="visible">&hellip;</td>`;
            for (let i = 1; i < iterations - 1; i++) {
                row += '<td class="hidden">'+values[i]+'</td>';
            }
            row += `<td>${values[values.length-1]}</td><td>${values.arithmeticMean()}</td><td>${values.standardDeviation()}</td></tr>`;
            return row;
        }

        let table = document.getElementById('table')
        table.innerHTML += header();
        for (let name = 0; name < 5; name++) {
            var values = [];
            for (let index = 0; index < iterations; index++) {
                values[index] = Math.random();
            }
            table.innerHTML += row(name + '-js', values);
            for (let index = 0; index < iterations; index++) {
                values[index] = Math.random();
            }
            table.innerHTML += row(name + '-wasm', values);
        }
    </script>
</body>
</html>